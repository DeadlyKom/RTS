
                ifndef _STRUCTURE_UNIT_
                define _STRUCTURE_UNIT_

                include "UnitType.inc"

                struct FUnit
;
;      7    6    5    4    3    2    1    0
;   +----+----+----+----+----+----+----+----+
;   | FT | .. | T4 | T3 | T2 | T1 | T0 | CP |
;   +----+----+----+----+----+----+----+----+
;
;   FT    - [7]     - тип фракции
;   Т4-T0 - [5..1]  - тип юнита
;   CP    - [0]     - флаг для 2х уровневых юнитов
;
Type            DB #00                                                          ; 1 byte (тип юнита)
;
;      7    6    5    4    3    2    1    0
;   +----+----+----+----+----+----+----+----+
;   | R1 | R0 | RE | .. | S2 | S1 | S0 | SE |
;   +----+----+----+----+----+----+----+----+
;
;   R1    - [7]     - необходимо обновить (экран 1)
;   R0    - [6]     - необходимо обновить (экран 0)
;   RE    - [5]     - объект провёл разведку
;   S2-S0 - [3..1]  - состояние юнита
;   SE    - [0]     - объект выбран
;
State           DB #00                                                          ; 1 byte (состояния поведения)
Position        FLocation                                                       ; 2 bytes (позиция в тайлах)
Offset          FLocation                                                       ; 2 bytes (смещение относительно тайла)
Target          FLocation                                                       ; 2 bytes (позиция цели)
;
;      7    6    5    4    3    2    1    0
;   +----+----+----+----+----+----+----+----+
;   | WP | IX | IN | LP | NX | O2 | O1 | O0 |
;   +----+----+----+----+----+----+----+----+
;
;   WP - [7]     бит валидности указанного Way Point
;   IX - [6]     бит валидности данных об индексе
;   IN - [5]     бит вставки (если 1 WP хранит временный путь, увеличивать смещение не нужно)
;   LP - [4]     бит зацикленности
;   NX - [3]     бит длины последовательности более 8, последний индекс (отсчёт от 7 до 0) в цепочке указывает индекс следующей цепочки
;   O  - [2..0]  смещение (обратное от 7 до 0)
;
Data            DB #00                                                          ; данные последовательности
Idx             DB #00                                                          ; 1 byte (индекс в массиве Way Points)
;
;      7    6    5    4    3    2    1    0
;   +----+----+----+----+----+----+----+----+
;   | DU | .. | D2 | D1 | D0 | U2 | U1 | U0 |
;   +----+----+----+----+----+----+----+----+
;
;   DU    - [7]     - бит принадлежности направлений (0 - только нижний, 1 - нижний и верхний)
;   D2-D0 - [5..3]  - направление нижней части
;   U2-U0 - [2..0]  - направление верхней части
;
;   направления
;               000 - up
;               001 - up-right
;               010 - right
;               011 - down-right
;               100 - down
;               101 - down-left
;               110 - left
;               111 - up-left
;
Direction       DB #00                                                          ; 1 byte (направления)
;
;      7    6    5    4    3    2    1    0
;   +----+----+----+----+----+----+----+----+
;   | .. | .. | .. | .. | .. | .. | A1 | A0 |
;   +----+----+----+----+----+----+----+----+
;
;   A1,A0 - [1,0]  - номер анимации
;
Animation       DB #00                                                          ; 1 byte (номер анимации)
;
; счётчик (нижний)
;
;      7    6    5    4    3    2    1    0
;   +----+----+----+----+----+----+----+----+
;   | TD | I1 | I0 | D4 | D3 | D2 | D1 | D0 |
;   +----+----+----+----+----+----+----+----+
;
;   TD    - [7]     - бит поворота (0 - поворот, 1 - перемещение)
;   I1,I0 - [6,5]   - счетчик поворота в состоянии IDLE
;   D4-D0 - [4..0]  - счётчик
;
CounterDown     DB #00                                                          ; 1 byte (счётчика)
;
; счётчик (верхний)
;
;      7    6    5    4    3    2    1    0
;   +----+----+----+----+----+----+----+----+
;   | TU | I1 | I0 | U4 | U3 | U2 | U1 | U0 |
;   +----+----+----+----+----+----+----+----+
;
;   TU    - [7]     - бит поворота (0 - поворот, 1 - перемещение) ?
;   I1,I0 - [6,5]   - счетчик поворота в состоянии IDLE
;   U4-U0 - [4..0]  - счётчик
;
CounterUp       DB #00                                                          ; 1 byte (счётчика)
Delta           DB #00                                                          ; 1 byte (дельта)
;
;      7    6    5    4    3    2    1    0
;   +----+----+----+----+----+----+----+----+
;   | ?? | .. | .. | .. | FL | CX | CY | CD |
;   +----+----+----+----+----+----+----+----+
;
;   FL    - [3]     - флаг мирцания объекта
;   CX    - [2]     - X = 0 - инкремент, 1 - декремент
;   CY    - [1]     - Y = 0 - инкремент, 1 - декремент
;   CD    - [0]     - принадлежность CounterDown (0 - поворот, 1 - перемещение)
;
Flags           DB #00                                                          ; 1 byte
Health          DB #00                                                          ; 1 byte (количество жизни)
Armor           DB #00                                                          ; 1 byte (количество брони)
Rank            DB #00                                                          ; 1 byte (ранг)
Killed          DB #00                                                          ; 1 byte (количество убитых)
BehaviorTree    FBehaviorTree                                                   ; 2 bytes (состояние дерева поведения)
CooldownShot    DB #00                                                          ; 1 byte (перезарядка выстрела)
                ends

UNIT_SIZE       EQU 32                                                          ; размер структуры юнита

                endif ; ~_STRUCTURE_UNIT_
