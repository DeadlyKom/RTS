
                ifndef _STRUCTURE_UNIT_
                define _STRUCTURE_UNIT_

UNIT_SIZE       EQU 32                                                          ; размер структуры юнита

                struct FUnit
; -----------------------------------------
;      7    6    5    4    3    2    1    0
;   +----+----+----+----+----+----+----+----+
;   | F1 | F0 | T4 | T3 | T2 | T1 | T0 | CU |
;   +----+----+----+----+----+----+----+----+
;
;   F1,F0   [7,6]   - тип фракции
;                       00 - игрок
;                       01 - природа/союзники
;                       10 - враг 1
;                       11 - враг 2
;   Т4-T0   [5..1]  - тип юнита
;   CU      [0]     - флаг композитный юнит ????
; -----------------------------------------
Type            DB #00                                                          ; 1 byte (тип юнита)

; -----------------------------------------
;      7    6    5    4    3    2    1    0
;   +----+----+----+----+----+----+----+----+
;   | RE | .. | .. | .. | .. | AT | MF | SE |
;   +----+----+----+----+----+----+----+----+
;
;   RE      [7]     - объект провёл разведку
;   AT      [2]     - объект атакует
;   MF      [1]     - объект движется (перемещается/летит)
;   SE      [0]     - объект выбран
; -----------------------------------------
State           DB #00                                                          ; 1 byte (состояния поведения)

; -----------------------------------------
;   структура хранения позиции:
;    - старший байт номер тайла
;    - младший байт значение с фиксированной точкой 4.4,
;      где целая часть смещение внутри тайла (16 пикселей)
;          дробная часть позволяет контролировать скорость перемещение
;
;   2 байта на каждую ось X,Y. фактический размер хранения позиции 2^12 в пикселях
;
;   +----+----+----+----+----+----+----+----+   +----+----+----+----+----+----+----+----+
;   | 15 | 14 | 13 | 12 | 11 | 10 |  9 |  8 |   |  7 |  6 |  5 |  4 |  3 |  2 |  1 |  0 |
;   +----+----+----+----+----+----+----+----+   +----+----+----+----+----+----+----+----+
;   | T7 | T6 | T5 | T4 | T3 | T2 | T1 | T0 |   | O3 | O2 | O1 | O0 | R0 | R1 | R2 | R3 |
;   +----+----+----+----+----+----+----+----+   +----+----+----+----+----+----+----+----+
;
;   T7-T0   [15..8] - значение тайла
;   O3-O0   [7..4]  - целая часть значения фиксированной точки 4.4
;   R0-R3   [3..0]  - дробная часть фиксированной точки 4.4
; -----------------------------------------
Position        FLocation16                                                     ; 4 bytes (позиция юнита)

Target          FLocation                                                       ; 2 bytes (позиция цели в тайлах)

; -----------------------------------------
;      7    6    5    4    3    2    1    0
;   +----+----+----+----+----+----+----+----+
;   | WP | IX | IN | LP | NX | O2 | O1 | O0 |
;   +----+----+----+----+----+----+----+----+
;
;   WP      [7]     - бит валидности указанного Way Point
;   IX      [6]     - бит валидности данных об индексе
;   IN      [5]     - бит вставки (если 1 WP хранит временный путь, увеличивать смещение не нужно)
;   LP      [4]     - бит зацикленности
;   NX      [3]     - бит длины последовательности более 8, последний индекс (отсчёт от 7 до 0) в цепочке указывает индекс следующей цепочки
;   O       [2..0]  - смещение (обратное от 7 до 0)
; -----------------------------------------
Data            DB #00                                                          ; 1 byte (данные последовательности)

Idx             DB #00                                                          ; 1 byte (индекс в массиве Way Points)

; -----------------------------------------
;      7    6    5    4    3    2    1    0
;   +----+----+----+----+----+----+----+----+
;   | DU | .. | D2 | D1 | D0 | U2 | U1 | U0 |
;   +----+----+----+----+----+----+----+----+
;
;   DU      [7]     - бит принадлежности направлений (0 - только нижний, 1 - нижний и верхний)
;   D2-D0   [5..3]  - направление нижней части
;   U2-U0   [2..0]  - направление верхней части
;                       000 - up
;                       001 - up-right
;                       010 - right
;                       011 - down-right
;                       100 - down
;                       101 - down-left
;                       110 - left
;                       111 - up-left
; -----------------------------------------
Direction       DB #00                                                          ; 1 byte (направления)

; -----------------------------------------
;      7    6    5    4    3    2    1    0
;   +----+----+----+----+----+----+----+----+
;   | .. | .. | .. | .. | U1 | U0 | D1 | D0 |
;   +----+----+----+----+----+----+----+----+
;
;   U1,U0   [3,2]   - номер анимации (верхней)
;   D1,D0   [1,0]   - номер анимации (нижней)
; -----------------------------------------
Animation       DB #00                                                          ; 1 byte (номер анимации)

; -----------------------------------------
; счётчик (нижний)
;
;      7    6    5    4    3    2    1    0
;   +----+----+----+----+----+----+----+----+
;   | TD | I1 | I0 | D4 | D3 | D2 | D1 | D0 |
;   +----+----+----+----+----+----+----+----+
;
;   TD      [7]     - бит поворота (0 - поворот, 1 - перемещение)
;   I1,I0   [6,5]   - счетчик поворота в состоянии IDLE
;   D4-D0   [4..0]  - счётчик
; -----------------------------------------
CounterDown     DB #00                                                          ; 1 byte (счётчика)

; -----------------------------------------
; счётчик (верхний)
;
;      7    6    5    4    3    2    1    0
;   +----+----+----+----+----+----+----+----+
;   | TU | I1 | I0 | U4 | U3 | U2 | U1 | U0 |
;   +----+----+----+----+----+----+----+----+
;
;   TU      [7]     - бит поворота (0 - поворот, 1 - перемещение) ?
;   I1,I0   [6,5]   - счетчик поворота в состоянии IDLE
;   U4-U0   [4..0]  - счётчик
; -----------------------------------------
CounterUp       DB #00                                                          ; 1 byte (счётчика)

Delta           DB #00                                                          ; 1 byte (дельта)

; -----------------------------------------
;      7    6    5    4    3    2    1    0
;   +----+----+----+----+----+----+----+----+
;   | ?? | .. | .. | .. | FL | CX | CY | CD |
;   +----+----+----+----+----+----+----+----+
;
;   FL      [3]     - флаг мирцания объекта
;   CX      [2]     - X = 0 - инкремент, 1 - декремент
;   CY      [1]     - Y = 0 - инкремент, 1 - декремент
;   CD      [0]     - принадлежность CounterDown (0 - поворот, 1 - перемещение)
; -----------------------------------------
Flags           DB #00                                                          ; 1 byte

Health          DB #00                                                          ; 1 byte (количество жизни)

Armor           DB #00                                                          ; 1 byte (количество брони)
; -----------------------------------------
;      7    6    5    4    3    2    1    0
;   +----+----+----+----+----+----+----+----+
;   | .. | .. | .. | .. | .. | R2 | R1 | R0 |
;   +----+----+----+----+----+----+----+----+
;
;   R2-R0   [2..0]  - ранг
;
; -----------------------------------------
Rank            DB #00                                                          ; 1 byte (ранг)

Killed          DB #00                                                          ; 1 byte (количество убитых)

BehaviorTree    FBehaviorTree                                                   ; 2 bytes (состояние дерева поведения)

CooldownShot    DB #00                                                          ; 1 byte (перезарядка выстрела)

                ends

                endif ; ~_STRUCTURE_UNIT_
